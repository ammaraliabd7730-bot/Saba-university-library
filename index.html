<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جامعة إقليم سباء - مكتبة الملخصات والنماذج</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* التنسيقات العامة */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --student-color: #9b59b6;
            --medical-color: #e74c3c;
            --drive-color: #4285F4;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            line-height: 1.6;
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* التصميم الجديد للرأس */
        header {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
            pointer-events: none;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            position: relative;
        }
        
        header h2 {
            font-size: 1.3rem;
            font-weight: 300;
            opacity: 0.9;
            position: relative;
        }
        
        /* شريط التنقل الجديد */
        nav {
            background-color: white;
            padding: 0.8rem 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        nav a {
            color: var(--dark-color);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        nav a:hover {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }
        
        nav a.student-link {
            color: var(--student-color);
        }
        
        nav a.student-link:hover {
            background-color: rgba(155, 89, 182, 0.1);
            color: var(--student-color);
        }
        
        nav a i {
            font-size: 1.1rem;
        }
        
        /* الصورة الشخصية */
        .profile-container {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-right: 1rem;
        }
        
        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* المحتوى الرئيسي */
        main {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* التذييل الجديد */
        footer {
            background-color: var(--secondary-color);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: auto;
            position: relative;
        }
        
        footer::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        footer p {
            margin-bottom: 0.5rem;
        }
        
        .contact-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
            margin: 1rem 0;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .contact-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .contact-item a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-links a {
            color: white;
            background-color: rgba(255,255,255,0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .social-links a:hover {
            background-color: var(--primary-color);
            transform: translateY(-3px);
        }
        
        /* كروت الكليات والأقسام */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            color: var(--dark-color);
            cursor: pointer;
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: rgba(52, 152, 219, 0.3);
        }
        
        .card::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: all 0.3s ease;
        }
        
        .card:hover::after {
            height: 6px;
        }
        
        .card h3 {
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }
        
        .card i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .card.medical i {
            color: var(--medical-color);
        }
        
        /* أزرار العودة */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 0.7rem 1.3rem;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
            box-shadow: 0 3px 6px rgba(52, 152, 219, 0.2);
        }
        
        .back-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(52, 152, 219, 0.3);
        }
        
        /* صفحات الملخصات والنماذج */
        .materials-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .materials-container {
                grid-template-columns: 1fr;
            }
            
            .profile-container {
                margin-right: 0;
                margin-bottom: 0.5rem;
            }
            
            .contact-info {
                flex-direction: column;
                align-items: center;
                gap: 0.8rem;
            }
        }
        
        .materials-section {
            background-color: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .materials-section h3 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .materials-section h3 i {
            color: var(--primary-color);
        }
        
        .file-list {
            list-style: none;
        }
        
        .file-item {
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-link {
            color: var(--dark-color);
            text-decoration: none;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }
        
        .file-link:hover {
            color: var(--primary-color);
        }
        
        .file-link i {
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        .file-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .download-btn, .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--dark-color);
            opacity: 0.7;
            transition: all 0.3s ease;
            font-size: 1rem;
            padding: 0.3rem;
        }
        
        .download-btn:hover {
            color: var(--primary-color);
            opacity: 1;
        }
        
        .delete-btn:hover {
            color: var(--accent-color);
            opacity: 1;
        }
        
        /* نموذج رفع الملفات */
        .upload-container {
            max-width: 800px;
            margin: 2rem auto;
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .upload-container h2 {
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
            text-align: center;
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .upload-container h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-group label i {
            color: var(--primary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #f9f9f9;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
            background-color: white;
        }
        
        .drive-icon {
            color: var(--drive-color);
            margin-left: 5px;
        }
        
        /* صفحة تسجيل الدخول */
        .login-container {
            max-width: 400px;
            margin: 3rem auto;
            background-color: white;
            padding: 2.5rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .login-container h2 {
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 1rem;
        }
        
        .login-container h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        .login-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        
        .login-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border: none;
            padding: 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .login-btn.student-btn {
            background: linear-gradient(135deg, var(--student-color), #8e44ad);
            box-shadow: 0 4px 10px rgba(155, 89, 182, 0.3);
        }
        
        .login-btn.student-btn:hover {
            box-shadow: 0 6px 15px rgba(155, 89, 182, 0.4);
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
        }
        
        /* عناصر للمسؤول فقط */
        .admin-only {
            display: none;
        }
        
        .admin-logged-in .admin-only {
            display: flex;
        }
        
        /* رسائل التنبيه */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .alert-success {
            background-color: rgba(39, 174, 96, 0.1);
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
        }
        
        .alert-error {
            background-color: rgba(231, 76, 60, 0.1);
            border-left: 4px solid var(--accent-color);
            color: var(--accent-color);
        }
        
        .alert i {
            font-size: 1.5rem;
        }
        
        /* الصفحات */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .active-page {
            display: block;
        }
        
        /* تأثيرات إضافية */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
        }
        
        /* أنماط المجتمع الطلابي */
        .chat-container {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .chat-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* غرف الدردشة */
        .chat-rooms {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            padding: 1rem;
            height: fit-content;
        }
        
        .chat-rooms h3 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--light-color);
        }
        
        .chat-room-list {
            list-style: none;
        }
        
        .chat-room-item {
            padding: 0.8rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }
        
        .chat-room-item:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .chat-room-item.active {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--primary-color);
        }
        
        .chat-window {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 500px;
        }
        
        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid var(--light-color);
        }
        
        .chat-header h3 {
            color: var(--secondary-color);
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            max-width: 80%;
            padding: 0.8rem;
            border-radius: 10px;
            position: relative;
        }
        
        .message.sent {
            background-color: #e3f2fd;
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }
        
        .message.received {
            background-color: #f5f5f5;
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }
        
        .message-body {
            word-wrap: break-word;
        }
        
        .chat-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--light-color);
        }
        
        .chat-input input {
            flex: 1;
            padding: 0.7rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .chat-input button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0 1.2rem;
            margin-left: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chat-input button:hover {
            background-color: #2980b9;
        }
        
        /* حالة الطالب */
        .student-status {
            background-color: rgba(155, 89, 182, 0.1);
            padding: 0.8rem;
            border-radius: 6px;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }
        
        /* تنبيهات الدردشة */
        .no-messages {
            text-align: center;
            padding: 2rem;
            color: #777;
        }
        
        /* صفحة إدارة الأقسام */
        .departments-list {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .department-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .department-item:last-child {
            border-bottom: none;
        }
        
        .department-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .add-department-form {
            background-color: #f9f9f9;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
        }
        
        /* رسالة التوجيه */
        .guidance-message {
            padding: 1rem;
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .guidance-message i {
            color: #ffc107;
            font-size: 1.2rem;
        }
        
        /* منطقة السحب والإفلات */
        .drop-zone {
            border: 2px dashed #3498db;
            border-radius: 6px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }
        
        .drop-zone:hover, .drop-zone.dragover {
            background-color: #e3f2fd;
            border-color: #2980b9;
        }
        
        .drop-zone i {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 0.5rem;
        }
        
        .file-info {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        /* خيارات الرفع */
        .upload-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .upload-option {
            flex: 1;
            padding: 1rem;
            border: 2px solid #eee;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-option.selected {
            border-color: #3498db;
            background-color: #e3f2fd;
        }
        
        .upload-option i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #3498db;
        }
        
        /* أنميشن للسبينر */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <header>
        <h1>جامعة إقليم سباء</h1>
        <h2>مكتبة الملخصات والنماذج والمجتمع الطلابي</h2>
    </header>
    
    <nav id="main-nav">
        <div class="profile-container">
            <img src="IMG_-45svl5.jpg" alt="الصورة الشخصية" class="profile-img">
            <div class="nav-links">
                <a href="#" onclick="showPage('home-page')"><i class="fas fa-home"></i> الرئيسية</a>
                <a href="#" onclick="showPage('upload-page')" class="admin-only"><i class="fas fa-upload"></i> رفع ملف</a>
                <a href="#" onclick="showPage('edit-subjects-page')" class="admin-only"><i class="fas fa-edit"></i> تعديل المواد</a>
                <a href="#" onclick="showPage('manage-departments-page')" class="admin-only"><i class="fas fa-building"></i> إدارة الأقسام</a>
                <a href="#" onclick="showPage('chat-page')" class="student-link"><i class="fas fa-comments"></i> المجتمع الطلابي</a>
                <a href="#" onclick="logout()" class="admin-only"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a>
                <a href="#" onclick="showPage('login-page')" id="login-link"><i class="fas fa-sign-in-alt"></i> تسجيل الدخول (مسؤول)</a>
                <a href="#" onclick="showPage('student-login-page')" id="student-login-link"><i class="fas fa-user-graduate"></i> تسجيل الدخول (طالب)</a>
                <a href="#" onclick="studentLogout()" id="student-logout-link" style="display:none;"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج (طالب)</a>
            </div>
        </div>
    </nav>
    
    <main>
        <!-- الصفحة الرئيسية -->
        <div id="home-page" class="page active-page">
            <div class="faculties-container">
                <h2><i class="fas fa-university"></i> الكليات</h2>
                <div class="grid-container">
                    <div class="card" onclick="showFaculty('كلية الآداب والعلوم الإنسانية')">
                        <i class="fas fa-book-open"></i>
                        <h3>كلية الآداب والعلوم الإنسانية</h3>
                    </div>
                    <div class="card" onclick="showFaculty('كلية التربية والعلوم')">
                        <i class="fas fa-graduation-cap"></i>
                        <h3>كلية التربية والعلوم</h3>
                    </div>
                    <div class="card" onclick="showFaculty('كلية الشريعة والقانون')">
                        <i class="fas fa-balance-scale"></i>
                        <h3>كلية الشريعة والقانون</h3>
                    </div>
                    <div class="card" onclick="showFaculty('كلية علوم الحاسوب')">
                        <i class="fas fa-laptop-code"></i>
                        <h3>كلية علوم الحاسوب</h3>
                    </div>
                    <div class="card" onclick="showFaculty('كلية العلوم الإدارية')">
                        <i class="fas fa-chart-line"></i>
                        <h3>كلية العلوم الإدارية</h3>
                    </div>
                    <!-- كلية الطب الجديدة -->
                    <div class="card medical" onclick="showFaculty('كلية الطب')">
                        <i class="fas fa-heartbeat"></i>
                        <h3>كلية الطب</h3>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- صفحة الكلية -->
        <div id="faculty-page" class="page">
            <div class="faculty-page">
                <h2 id="faculty-name"></h2>
                <div class="grid-container" id="departments-list">
                    <!-- سيتم ملؤها بالجافاسكريبت -->
                </div>
                <button class="back-button" onclick="showPage('home-page')"><i class="fas fa-arrow-right"></i> العودة إلى الكليات</button>
            </div>
        </div>
        
        <!-- صفحة القسم -->
        <div id="department-page" class="page">
            <div class="department-page">
                <h2 id="department-name"></h2>
                <h3 id="faculty-name-dept"></h3>
                
                <div class="levels-container">
                    <h4><i class="fas fa-layer-group"></i> المستويات الدراسية:</h4>
                    <div class="grid-container">
                        <div class="card" onclick="showLevel('المستوى الأول')">
                            <i class="fas fa-1"></i>
                            <h3>المستوى الأول</h3>
                        </div>
                        <div class="card" onclick="showLevel('المستوى الثاني')">
                            <i class="fas fa-2"></i>
                            <h3>المستوى الثاني</h3>
                        </div>
                        <div class="card" onclick="showLevel('المستوى الثالث')">
                            <i class="fas fa-3"></i>
                            <h3>المستوى الثالث</h3>
                        </div>
                        <div class="card" onclick="showLevel('المستوى الرابع')">
                            <i class="fas fa-4"></i>
                            <h3>المستوى الرابع</h3>
                        </div>
                    </div>
                </div>
                
                <button class="back-button" onclick="goBackToFaculty()"><i class="fas fa-arrow-right"></i> العودة إلى أقسام الكلية</button>
            </div>
        </div>
        
        <!-- صفحة المستوى -->
        <div id="level-page" class="page">
            <div class="level-page">
                <h2 id="department-name-level"></h2>
                <h3 id="faculty-level-info"></h3>
                
                <div class="materials-container">
                    <div class="materials-section">
                        <h3><i class="fas fa-file-alt"></i> الملخصات:</h3>
                        <ul class="file-list" id="summaries-list">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </ul>
                    </div>
                    
                    <div class="materials-section">
                        <h3><i class="fas fa-file-pdf"></i> النماذج:</h3>
                        <ul class="file-list" id="models-list">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </ul>
                    </div>
                </div>
                
                <div class="terms-container" id="terms-container">
                    <h4><i class="fas fa-calendar-alt"></i> الترم الدراسي:</h4>
                    <div class="grid-container">
                        <div class="card" onclick="showTerm('الترم الأول')">
                            <i class="fas fa-sun"></i>
                            <h3>الترم الأول</h3>
                        </div>
                        <div class="card" onclick="showTerm('الترم الثاني')">
                            <i class="fas fa-moon"></i>
                            <h3>الترم الثاني</h3>
                        </div>
                    </div>
                </div>
                
                <button class="back-button" onclick="goBackToDepartment()"><i class="fas fa-arrow-right"></i> العودة إلى مستويات القسم</button>
            </div>
        </div>
        
        <!-- صفحة الترم -->
        <div id="term-page" class="page">
            <div class="term-page">
                <h2 id="department-name-term"></h2>
                <h3 id="level-term-info"></h3>
                <h4 id="term-name"></h4>
                
                <div class="subjects-container">
                    <div class="grid-container" id="subjects-grid">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
                
                <button class="back-button" onclick="goBackToLevel()"><i class="fas fa-arrow-right"></i> العودة إلى المواد الدراسية</button>
            </div>
        </div>
        
        <!-- صفحة رفع الملفات -->
        <div id="upload-page" class="page">
            <div class="upload-container">
                <h2><i class="fas fa-upload"></i> رفع ملخص أو نموذج جديد</h2>
                
                <div id="upload-alert" style="display: none;"></div>
                
                <form id="upload-form">
                    <div class="upload-options">
                        <div class="upload-option selected" id="drive-option" onclick="selectUploadOption('drive')">
                            <i class="fab fa-google-drive"></i>
                            <div>رابط جوجل درايف</div>
                        </div>
                        <div class="upload-option" id="file-option" onclick="selectUploadOption('file')">
                            <i class="fas fa-file-upload"></i>
                            <div>رفع ملف</div>
                        </div>
                    </div>
                    
                    <div id="drive-upload">
                        <div class="form-group">
                            <label for="drive-link"><i class="fab fa-google-drive drive-icon"></i> رابط جوجل درايف:</label>
                            <input type="url" id="drive-link" class="form-control" placeholder="https://drive.google.com/..." required>
                        </div>
                    </div>
                    
                    <div id="file-upload" style="display: none;">
                        <div class="drop-zone" id="drop-zone">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>اسحب ملفك هنا أو انقر للاختيار</p>
                            <p class="file-info">(الحد الأقصى لحجم الملف: 50MB)</p>
                            <input type="file" id="file-input" style="display: none;" onchange="handleFileSelect(event)">
                        </div>
                        <div id="file-preview"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="file-type"><i class="fas fa-file"></i> نوع الملف:</label>
                        <select id="file-type" class="form-control" required>
                            <option value="">اختر نوع الملف</option>
                            <option value="ملخصات">ملخص</option>
                            <option value="نماذج">نموذج</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="faculty"><i class="fas fa-university"></i> الكلية:</label>
                        <select id="faculty" class="form-control" required onchange="updateDepartments()">
                            <option value="">اختر الكلية</option>
                            <option value="كلية الآداب والعلوم الإنسانية">كلية الآداب والعلوم الإنسانية</option>
                            <option value="كلية التربية والعلوم">كلية التربية والعلوم</option>
                            <option value="كلية الشريعة والقانون">كلية الشريعة والقانون</option>
                            <option value="كلية علوم الحاسوب">كلية علوم الحاسوب</option>
                            <option value="كلية العلوم الإدارية">كلية العلوم الإدارية</option>
                            <!-- إضافة كلية الطب -->
                            <option value="كلية الطب">كلية الطب</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="department"><i class="fas fa-building"></i> القسم:</label>
                        <select id="department" class="form-control" required>
                            <option value="">اختر القسم</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="level"><i class="fas fa-layer-group"></i> المستوى:</label>
                        <select id="level" class="form-control" required>
                            <option value="">اختر المستوى</option>
                            <option value="المستوى الأول">المستوى الأول</option>
                            <option value="المستوى الثاني">المستوى الثاني</option>
                            <option value="المستوى الثالث">المستوى الثالث</option>
                            <option value="المستوى الرابع">المستوى الرابع</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="term"><i class="fas fa-calendar-alt"></i> الترم:</label>
                        <select id="term" class="form-control" required>
                            <option value="">اختر الترم</option>
                            <option value="الترم الأول">الترم الأول</option>
                            <option value="الترم الثاني">الترم الثاني</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="subject"><i class="fas fa-book"></i> المادة:</label>
                        <select id="subject" class="form-control" required>
                            <option value="">اختر المادة</option>
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="file-name"><i class="fas fa-file-signature"></i> اسم الملف:</label>
                        <input type="text" id="file-name" class="form-control" placeholder="اسم الملف كما سيظهر للطلاب" required>
                    </div>
                    
                    <button type="button" class="submit-btn" onclick="uploadFile()">
                        <i class="fas fa-upload"></i> رفع الملف
                    </button>
                </form>
            </div>
        </div>
        
        <!-- صفحة تعديل المواد الدراسية -->
        <div id="edit-subjects-page" class="page">
            <div class="upload-container">
                <h2><i class="fas fa-edit"></i> تعديل المواد الدراسية</h2>
                
                <div id="edit-alert" style="display: none;"></div>
                
                <div id="edit-guidance" class="guidance-message" style="display: none;">
                    <i class="fas fa-info-circle"></i>
                    <div>الرجاء تحديد الكلية والقسم والمستوى والترم لتحميل المواد</div>
                </div>
                
                <form id="edit-subjects-form">
                    <div class="form-group">
                        <label for="edit-faculty"><i class="fas fa-university"></i> الكلية:</label>
                        <select id="edit-faculty" class="form-control" required onchange="updateEditDepartments()">
                            <option value="">اختر الكلية</option>
                            <option value="كلية الآداب والعلوم الإنسانية">كلية الآداب والعلوم الإنسانية</option>
                            <option value="كلية التربية والعلوم">كلية التربية والعلوم</option>
                            <option value="كلية الشريعة والقانون">كلية الشريعة والقانون</option>
                            <option value="كلية علوم الحاسوب">كلية علوم الحاسوب</option>
                            <option value="كلية العلوم الإدارية">كلية العلوم الإدارية</option>
                            <!-- إضافة كلية الطب -->
                            <option value="كلية الطب">كلية الطب</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-department"><i class="fas fa-building"></i> القسم:</label>
                        <select id="edit-department" class="form-control" required onchange="updateEditLevels()">
                            <option value="">اختر القسم</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-level"><i class="fas fa-layer-group"></i> المستوى:</label>
                        <select id="edit-level" class="form-control" required onchange="updateEditTerms()">
                            <option value="">اختر المستوى</option>
                            <option value="المستوى الأول">المستوى الأول</option>
                            <option value="المستوى الثاني">المستوى الثاني</option>
                            <option value="المستوى الثالث">المستوى الثالث</option>
                            <option value="المستوى الرابع">المستوى الرابع</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-term"><i class="fas fa-calendar-alt"></i> الترم:</label>
                        <select id="edit-term" class="form-control" required onchange="loadSubjects()">
                            <option value="">اختر الترم</option>
                            <option value="الترم الأول">الترم الأول</option>
                            <option value="الترم الثاني">الترم الثاني</option>
                        </select>
                    </div>
                    
                    <div id="subjects-edit-container">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                    
                    <button type="button" class="submit-btn" onclick="saveSubjects()">
                        <i class="fas fa-save"></i> حفظ التعديلات
                    </button>
                </form>
            </div>
        </div>
        
        <!-- صفحة إدارة الأقسام -->
        <div id="manage-departments-page" class="page">
            <div class="upload-container">
                <h2><i class="fas fa-building"></i> إدارة الأقسام</h2>
                
                <div id="departments-alert" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="manage-faculty"><i class="fas fa-university"></i> الكلية:</label>
                    <select id="manage-faculty" class="form-control" required onchange="loadDepartments()">
                        <option value="">اختر الكلية</option>
                        <option value="كلية الآداب والعلوم الإنسانية">كلية الآداب والعلوم الإنسانية</option>
                        <option value="كلية التربية والعلوم">كلية التربية والعلوم</option>
                        <option value="كلية الشريعة والقانون">كلية الشريعة والقانون</option>
                        <option value="كلية علوم الحاسوب">كلية علوم الحاسوب</option>
                        <option value="كلية العلوم الإدارية">كلية العلوم الإدارية</option>
                        <option value="كلية الطب">كلية الطب</option>
                    </select>
                </div>
                
                <div id="current-departments">
                    <!-- سيتم ملؤها بالأقسام الحالية -->
                </div>
                
                <div class="add-department-form">
                    <h3><i class="fas fa-plus"></i> إضافة قسم جديد</h3>
                    <div class="form-group">
                        <label for="new-department"><i class="fas fa-building"></i> اسم القسم الجديد:</label>
                        <input type="text" id="new-department" class="form-control" placeholder="أدخل اسم القسم الجديد">
                    </div>
                    <button class="submit-btn" onclick="addDepartment()">
                        <i class="fas fa-plus"></i> إضافة القسم
                    </button>
                </div>
            </div>
        </div>
        
        <!-- صفحة تسجيل الدخول -->
        <div id="login-page" class="page">
            <div class="login-container">
                <div class="login-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h2>تسجيل الدخول للمسؤول</h2>
                
                <div id="login-alert" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="admin-username"><i class="fas fa-user"></i> اسم المستخدم:</label>
                    <input type="text" id="admin-username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="admin-password"><i class="fas fa-key"></i> كلمة المرور:</label>
                    <input type="password" id="admin-password" class="form-control" required>
                </div>
                <button class="login-btn" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
                </button>
            </div>
        </div>
        
        <!-- صفحة تسجيل الدخول للطلاب -->
        <div id="student-login-page" class="page">
            <div class="login-container">
                <div class="login-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <h2>تسجيل الدخول للطلاب</h2>
                
                <div id="student-login-alert" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="student-email"><i class="fas fa-envelope"></i> البريد الإلكتروني:</label>
                    <input type="email" id="student-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="student-password"><i class="fas fa-key"></i> كلمة المرور:</label>
                    <input type="password" id="student-password" class="form-control" required>
                </div>
                <button class="login-btn student-btn" onclick="studentLogin()">
                    <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
                </button>
                <p style="margin-top: 1rem;">
                    ليس لديك حساب؟ <a href="#" onclick="showPage('student-register-page')">سجل الآن</a>
                </p>
            </div>
        </div>
        
        <!-- صفحة تسجيل الطلاب الجدد -->
        <div id="student-register-page" class="page">
            <div class="login-container">
                <div class="login-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h2>تسجيل طالب جديد</h2>
                
                <div id="student-register-alert" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="student-name"><i class="fas fa-user"></i> الاسم الكامل:</label>
                    <input type="text" id="student-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="student-email-register"><i class="fas fa-envelope"></i> البريد الإلكتروني:</label>
                    <input type="email" id="student-email-register" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="student-faculty"><i class="fas fa-university"></i> الكلية:</label>
                    <select id="student-faculty" class="form-control" required>
                        <option value="">اختر الكلية</option>
                        <option value="كلية الآداب والعلوم الإنسانية">كلية الآداب والعلوم الإنسانية</option>
                        <option value="كلية التربية والعلوم">كلية التربية والعلوم</option>
                        <option value="كلية الشريعة والقانون">كلية الشريعة والقانون</option>
                        <option value="كلية علوم الحاسوب">كلية علوم الحاسوب</option>
                        <option value="كلية العلوم الإدارية">كلية العلوم الإدارية</option>
                        <option value="كلية الطب">كلية الطب</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="student-password-register"><i class="fas fa-key"></i> كلمة المرور:</label>
                    <input type="password" id="student-password-register" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="confirm-password"><i class="fas fa-key"></i> تأكيد كلمة المرور:</label>
                    <input type="password" id="confirm-password" class="form-control" required>
                </div>
                <button id="register-btn" class="login-btn student-btn" onclick="registerStudent()">
                    <i class="fas fa-user-plus"></i> تسجيل
                </button>
                <p style="margin-top: 1rem;">
                    لديك حساب؟ <a href="#" onclick="showPage('student-login-page')">سجل الدخول</a>
                </p>
            </div>
        </div>
        
        <!-- صفحة المجتمع الطلابي -->
        <div id="chat-page" class="page">
            <div class="chat-container">
                <div class="chat-rooms">
                    <h3><i class="fas fa-comments"></i> غرف الدردشة</h3>
                    <ul class="chat-room-list">
                        <li class="chat-room-item active" data-room="general">
                            <i class="fas fa-globe"></i>
                            <span>الغرفة العامة</span>
                        </li>
                        <li class="chat-room-item" data-room="questions">
                            <i class="fas fa-question-circle"></i>
                            <span>أسئلة ومساعدة</span>
                        </li>
                    </ul>
                    
                    <div class="student-status" id="student-status" style="display: none;">
                        <i class="fas fa-user-circle"></i>
                        <span>مرحبًا بك، <span id="current-student-name"></span></span>
                    </div>
                </div>
                
                <div class="chat-window">
                    <div class="chat-header">
                        <h3 id="current-chat-room">الغرفة العامة</h3>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <!-- سيتم ملؤها بالرسائل -->
                    </div>
                    <div class="chat-input">
                        <input type="text" id="message-input" placeholder="اكتب رسالتك هنا..." class="form-control">
                        <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>جميع الحقوق محفوظة &copy; جامعة إقليم سباء <span id="current-year"></span></p>
        <p>مكتبة الملخصات والنماذج والمجتمع الطلابي</p>
        
        <div class="contact-info">
            <div class="contact-item">
                <i class="fas fa-envelope"></i>
                <a href="mailto:ammaraliabd7730@gmail.com">ammaraliabd7730@gmail.com</a>
            </div>
            <div class="contact-item">
                <i class="fab fa-whatsapp"></i>
                <a href="https://wa.me/967773072552">+967773072552</a>
            </div>
        </div>
        
        <div class="social-links">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
    </footer>
    
    <script>
        // بيانات الكليات والأقسام
        const facultiesData = {
            "كلية الآداب والعلوم الإنسانية": {
                "departments": [
                    "قسم اللغة الإنجليزية",
                    "قسم الدراسات الإسلامية",
                    "قسم اللغة العربية",
                    "قسم التاريخ والآثار",
                    "قسم العلوم السياسية",
                    "قسم الإعلام والفنون"
                ]
            },
            "كلية التربية والعلوم": {
                "departments": [
                    "قسم اللغة الإنجليزية",
                    "قسم الرياضيات",
                    "قسم الأحياء",
                    "قسم الدراسات الإسلامية",
                    "قسم الكيمياء",
                    "قسم معلم صف",
                    "قسم علوم القرآن"
                ]
            },
            "كلية الشريعة والقانون": {
                "departments": [
                    "قسم الشريعة والقانون"
                ]
            },
            "كلية علوم الحاسوب": {
                "departments": [
                    "قسم IT",
                    "قسم نظم المعلومات",
                    "قسم علوم الحاسوب"
                ]
            },
            "كلية العلوم الإدارية": {
                "departments": [
                    "إدارة عامة",
                    "إدارة أعمال",
                    "المصارف",
                    "المحاسبة",
                    "قسم التسويق"
                ]
            },
            "كلية الطب": {
                "departments": [
                    "قسم طب عام"
                ]
            }
        };
        
        // بيانات المسؤول
        const adminCredentials = {
            username: "admin",
            password: "saba1234"
        };
        
        // عنوان API لاستضافة Vercel
        const API_BASE_URL = "https://saba-university-api.vercel.app/api";
        
        // متغيرات لتتبع الصفحة الحالية
        let currentFaculty = '';
        let currentDepartment = '';
        let currentLevel = '';
        let currentTerm = '';
        let isAdmin = false;
        let currentStudent = null;
        let currentChatRoom = 'general';
        let selectedFile = null;
        const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
        const MAX_MESSAGE_LENGTH = 200; // الحد الأقصى لطول الرسالة
        
        // عرض السنة الحالية في الفوتر
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // إعداد منطقة السحب والإفلات
        document.getElementById('drop-zone').addEventListener('click', () => {
            document.getElementById('file-input').click();
        });
        
        document.getElementById('drop-zone').addEventListener('dragover', (e) => {
            e.preventDefault();
            document.getElementById('drop-zone').classList.add('dragover');
        });
        
        document.getElementById('drop-zone').addEventListener('dragleave', () => {
            document.getElementById('drop-zone').classList.remove('dragover');
        });
        
        document.getElementById('drop-zone').addEventListener('drop', (e) => {
            e.preventDefault();
            document.getElementById('drop-zone').classList.remove('dragover');
            
            if (e.dataTransfer.files.length) {
                handleFileSelect(e);
            }
        });
        
        // عرض رسالة تنبيه
        function showAlert(elementId, type, message) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = `
                <div class="alert alert-${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <div>${message}</div>
                </div>
            `;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        // اختيار طريقة الرفع
        function selectUploadOption(option) {
            document.getElementById('drive-option').classList.remove('selected');
            document.getElementById('file-option').classList.remove('selected');
            document.getElementById('drive-upload').style.display = 'none';
            document.getElementById('file-upload').style.display = 'none';
            
            if (option === 'drive') {
                document.getElementById('drive-option').classList.add('selected');
                document.getElementById('drive-upload').style.display = 'block';
            } else {
                document.getElementById('file-option').classList.add('selected');
                document.getElementById('file-upload').style.display = 'block';
            }
        }
        
        // اختيار الملف
        function handleFileSelect(event) {
            const file = event.dataTransfer ? event.dataTransfer.files[0] : event.target.files[0];
            
            if (!file) return;
            
            if (file.size > MAX_FILE_SIZE) {
                showAlert('upload-alert', 'error', 'حجم الملف كبير جدًا! الحد الأقصى 50MB');
                return;
            }
            
            selectedFile = file;
            
            // عرض معلومات الملف
            const filePreview = document.getElementById('file-preview');
            filePreview.innerHTML = `
                <div class="file-info">
                    <i class="fas fa-file"></i>
                    <span>${file.name} (${formatFileSize(file.size)})</span>
                </div>
            `;
        }
        
        // تنسيق حجم الملف
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // دالة للتحقق من حالة المستخدم عند تحميل الصفحة
        function checkAuthState() {
            // التحقق من حالة المسؤول
            const savedAdmin = localStorage.getItem('isAdmin');
            if (savedAdmin === 'true') {
                isAdmin = true;
                document.body.classList.add('admin-logged-in');
            }
            
            // التحقق من حالة الطالب
            const savedStudent = localStorage.getItem('currentStudent');
            if (savedStudent) {
                currentStudent = JSON.parse(savedStudent);
                document.getElementById('student-login-link').style.display = 'none';
                document.getElementById('student-logout-link').style.display = 'inline-flex';
                document.getElementById('student-status').style.display = 'flex';
                document.getElementById('current-student-name').textContent = currentStudent.name;
                document.getElementById('login-link').style.display = 'none';
            }
        }
        
        // تسجيل الدخول
        function login() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                isAdmin = true;
                document.body.classList.add('admin-logged-in');
                showAlert('login-alert', 'success', 'تم تسجيل الدخول بنجاح كمسؤول');
                
                // حفظ حالة تسجيل الدخول في localStorage
                localStorage.setItem('isAdmin', 'true');
                
                setTimeout(() => showPage('home-page'), 1000);
            } else {
                showAlert('login-alert', 'error', 'اسم المستخدم أو كلمة المرور غير صحيحة');
            }
        }
        
        // تسجيل الخروج
        function logout() {
            isAdmin = false;
            document.body.classList.remove('admin-logged-in');
            showAlert('upload-alert', 'success', 'تم تسجيل الخروج بنجاح');
            
            // إزالة حالة تسجيل الدخول من localStorage
            localStorage.removeItem('isAdmin');
            
            setTimeout(() => showPage('home-page'), 1000);
        }
        
        // تسجيل الدخول للطلاب
        function studentLogin() {
            const email = document.getElementById('student-email').value;
            const password = document.getElementById('student-password').value;
            
            if (!email || !password) {
                showAlert('student-login-alert', 'error', 'الرجاء إدخال البريد الإلكتروني وكلمة المرور');
                return;
            }
            
            // محاكاة اتصال API
            fetch(`${API_BASE_URL}/students/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentStudent = data.student;
                    
                    document.getElementById('student-login-link').style.display = 'none';
                    document.getElementById('student-logout-link').style.display = 'inline-flex';
                    document.getElementById('student-status').style.display = 'flex';
                    document.getElementById('current-student-name').textContent = currentStudent.name;
                    document.getElementById('login-link').style.display = 'none';
                    
                    // حفظ حالة تسجيل الدخول في localStorage
                    localStorage.setItem('currentStudent', JSON.stringify(currentStudent));
                    
                    showAlert('student-login-alert', 'success', 'تم تسجيل الدخول بنجاح');
                    setTimeout(() => showPage('home-page'), 1000);
                } else {
                    showAlert('student-login-alert', 'error', data.message);
                }
            })
            .catch(error => {
                showAlert('student-login-alert', 'error', 'حدث خطأ أثناء تسجيل الدخول');
            });
        }
        
        // تسجيل الطالب الجديد
        function registerStudent() {
            const name = document.getElementById('student-name').value.trim();
            const email = document.getElementById('student-email-register').value.trim();
            const faculty = document.getElementById('student-faculty').value;
            const password = document.getElementById('student-password-register').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const registerBtn = document.getElementById('register-btn');
            
            // التحقق من الحقول الفارغة
            if (!name || !email || !faculty || !password || !confirmPassword) {
                showAlert('student-register-alert', 'error', 'الرجاء ملء جميع الحقول');
                return;
            }
            
            // التحقق من تطابق كلمات المرور
            if (password !== confirmPassword) {
                showAlert('student-register-alert', 'error', 'كلمتا المرور غير متطابقتين');
                return;
            }
            
            // التحقق من صحة البريد الإلكتروني
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showAlert('student-register-alert', 'error', 'البريد الإلكتروني غير صالح');
                return;
            }
            
            // التحقق من قوة كلمة المرور
            if (password.length < 6) {
                showAlert('student-register-alert', 'error', 'كلمة المرور يجب أن تكون على الأقل 6 أحرف');
                return;
            }
            
            // عرض مؤشر تحميل وتعطيل الزر
            registerBtn.innerHTML = '<i class="fas fa-spinner spinner"></i> جاري التسجيل...';
            registerBtn.disabled = true;
            
            // تسجيل الطالب في API
            fetch(`${API_BASE_URL}/students/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name, 
                    email, 
                    faculty, 
                    password 
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('student-register-alert', 'success', 'تم تسجيل الحساب بنجاح! يمكنك الآن تسجيل الدخول');
                    
                    // إعادة تعيين النموذج
                    document.getElementById('student-name').value = '';
                    document.getElementById('student-email-register').value = '';
                    document.getElementById('student-faculty').value = '';
                    document.getElementById('student-password-register').value = '';
                    document.getElementById('confirm-password').value = '';
                    
                    // الانتقال إلى صفحة تسجيل الدخول بعد ثانية
                    setTimeout(() => {
                        showPage('student-login-page');
                        registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> تسجيل';
                        registerBtn.disabled = false;
                    }, 1500);
                } else {
                    showAlert('student-register-alert', 'error', data.message || 'حدث خطأ أثناء التسجيل');
                    registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> تسجيل';
                    registerBtn.disabled = false;
                }
            })
            .catch(error => {
                showAlert('student-register-alert', 'error', 'حدث خطأ في الاتصال بالخادم');
                registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> تسجيل';
                registerBtn.disabled = false;
            });
        }
        
        // تسجيل الخروج للطلاب
        function studentLogout() {
            currentStudent = null;
            document.getElementById('student-login-link').style.display = 'inline-flex';
            document.getElementById('student-logout-link').style.display = 'none';
            document.getElementById('student-status').style.display = 'none';
            document.getElementById('login-link').style.display = 'inline-flex';
            
            // إزالة حالة تسجيل الدخول من localStorage
            localStorage.removeItem('currentStudent');
            
            showPage('home-page');
        }
        
        // وظائف إدارة الصفحات
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active-page');
            });
            document.getElementById(pageId).classList.add('active-page');
            
            if (pageId === 'chat-page') {
                displayChatMessages();
            }
            else if (pageId === 'edit-subjects-page') {
                // عرض رسالة توجيهية إذا لم يتم تحميل المواد
                const faculty = document.getElementById('edit-faculty').value;
                const department = document.getElementById('edit-department').value;
                const level = document.getElementById('edit-level').value;
                const term = document.getElementById('edit-term').value;
                
                if (!faculty || !department || !level || !term) {
                    document.getElementById('edit-guidance').style.display = 'flex';
                } else {
                    document.getElementById('edit-guidance').style.display = 'none';
                    loadSubjects();
                }
            }
        }
        
        function showFaculty(facultyName) {
            currentFaculty = facultyName;
            document.getElementById('faculty-name').textContent = facultyName;
            
            const departmentsList = document.getElementById('departments-list');
            departmentsList.innerHTML = '';
            
            facultiesData[facultyName].departments.forEach(dept => {
                const deptCard = document.createElement('div');
                deptCard.className = 'card';
                deptCard.innerHTML = `
                    <i class="fas fa-building"></i>
                    <h3>${dept}</h3>
                `;
                deptCard.onclick = function() {
                    showDepartment(dept);
                };
                departmentsList.appendChild(deptCard);
            });
            
            showPage('faculty-page');
        }
        
        function showDepartment(departmentName) {
            currentDepartment = departmentName;
            document.getElementById('department-name').textContent = departmentName;
            document.getElementById('faculty-name-dept').textContent = currentFaculty;
            showPage('department-page');
        }
        
        function showLevel(level) {
            currentLevel = level;
            document.getElementById('department-name-level').textContent = currentDepartment;
            document.getElementById('faculty-level-info').textContent = `${currentFaculty} - ${level}`;
            
            // عرض الملخصات والنماذج
            const summariesList = document.getElementById('summaries-list');
            const modelsList = document.getElementById('models-list');
            
            summariesList.innerHTML = '';
            modelsList.innerHTML = '';
            
            // جلب البيانات من API
            fetch(`${API_BASE_URL}/files?faculty=${currentFaculty}&department=${currentDepartment}&level=${level}`)
            .then(response => response.json())
            .then(files => {
                const summaries = files.filter(file => file.type === 'ملخصات');
                const models = files.filter(file => file.type === 'نماذج');
                
                // عرض الملخصات
                displayFileList(summariesList, summaries, 'ملخصات');
                // عرض النماذج
                displayFileList(modelsList, models, 'نماذج');
            })
            .catch(error => {
                console.error('حدث خطأ أثناء جلب الملفات:', error);
            });
            
            showPage('level-page');
        }
        
        // دالة مساعدة لعرض قائمة الملفات
        function displayFileList(listElement, files, type) {
            listElement.innerHTML = '';
            
            if (files.length === 0) {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.textContent = 'لا توجد ملفات متاحة حالياً';
                listElement.appendChild(li);
                return;
            }
            
            files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <a href="${file.url}" class="file-link" target="_blank">
                        <i class="fas fa-file-${type === 'ملخصات' ? 'alt' : 'pdf'}"></i>
                        ${file.name}
                    </a>
                    ${isAdmin ? `
                    <div class="file-actions">
                        <a href="${file.url}" class="download-btn" target="_blank">
                            <i class="fas fa-download"></i>
                        </a>
                        <button class="delete-btn" onclick="deleteFile('${file.id}', '${file.type}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    ` : ''}
                `;
                listElement.appendChild(li);
            });
        }
        
        function showTerm(term) {
            currentTerm = term;
            document.getElementById('department-name-term').textContent = currentDepartment;
            document.getElementById('level-term-info').textContent = `${currentFaculty} - ${currentLevel}`;
            document.getElementById('term-name').textContent = term;
            
            const subjectsGrid = document.getElementById('subjects-grid');
            subjectsGrid.innerHTML = '';
            
            // جلب المواد من API
            fetch(`${API_BASE_URL}/subjects?faculty=${currentFaculty}&department=${currentDepartment}&level=${currentLevel}&term=${term}`)
            .then(response => response.json())
            .then(subjects => {
                subjectsGrid.innerHTML = '';
                
                if (subjects.length === 0) {
                    subjectsGrid.innerHTML = '<p>لا توجد مواد متاحة لهذا الترم</p>';
                    return;
                }
                
                subjects.forEach(subject => {
                    const subjectCard = document.createElement('div');
                    subjectCard.className = 'card';
                    subjectCard.innerHTML = `
                        <i class="fas fa-book"></i>
                        <h3>${subject.name}</h3>
                        <div class="subject-content">
                            <p>${subject.description}</p>
                            ${subject.files && subject.files.length > 0 ? 
                                `<p><i class="fas fa-file"></i> عدد الملفات: ${subject.files.length}</p>` : 
                                '<p><i class="fas fa-exclamation-circle"></i> لا توجد ملفات بعد</p>'}
                        </div>
                    `;
                    subjectCard.onclick = function() {
                        showSubjectFiles(subject);
                    };
                    subjectsGrid.appendChild(subjectCard);
                });
            })
            .catch(error => {
                console.error('حدث خطأ أثناء جلب المواد:', error);
            });
            
            showPage('term-page');
        }
        
        function showSubjectFiles(subject) {
            // إنشاء نافذة عرض الملفات
            const filesWindow = window.open('', '_blank', 'width=600,height=400');
            filesWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <title>${subject.name} - ملفات المادة</title>
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            padding: 20px;
                            background-color: #f5f7fa;
                        }
                        h2 {
                            color: #2c3e50;
                            text-align: center;
                            margin-bottom: 20px;
                        }
                        ul {
                            list-style: none;
                            padding: 0;
                        }
                        li {
                            padding: 10px;
                            background: white;
                            margin-bottom: 10px;
                            border-radius: 5px;
                            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        }
                        .file-link {
                            color: #3498db;
                            text-decoration: none;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        .file-actions button {
                            background: none;
                            border: none;
                            cursor: pointer;
                            margin-left: 10px;
                        }
                        .download-btn {
                            color: #3498db;
                        }
                        .delete-btn {
                            color: #e74c3c;
                        }
                    </style>
                </head>
                <body>
                    <h2><i class="fas fa-book"></i> ${subject.name}</h2>
                    <p>${subject.description}</p>
                    <h3><i class="fas fa-files"></i> ملفات المادة:</h3>
                    <ul id="subject-files-list">
                        ${subject.files && subject.files.length > 0 ? 
                            subject.files.map(file => {
                                return `
                                    <li>
                                        <a href="${file.url}" class="file-link" target="_blank">
                                            <i class="fas fa-file-${file.type === 'ملخصات' ? 'alt' : 'pdf'}"></i>
                                            ${file.name}
                                        </a>
                                        ${isAdmin ? `
                                        <div class="file-actions">
                                            <a href="${file.url}" class="download-btn" target="_blank">
                                                <i class="fas fa-download"></i>
                                            </a>
                                            <button class="delete-btn" onclick="window.opener.deleteFile('${file.id}', '${file.type}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        ` : ''}
                                    </li>
                                `;
                            }).join('') : 
                            '<li>لا توجد ملفات لهذه المادة بعد</li>'}
                    </ul>
                </body>
                </html>
            `);
            filesWindow.document.close();
        }
        
        // حذف الملف
        function deleteFile(fileId, fileType) {
            if (!isAdmin) {
                alert('ليس لديك صلاحية حذف الملفات');
                return;
            }
            
            if (!confirm('هل أنت متأكد من حذف هذا الملف؟')) return;
            
            // حذف الملف من API
            fetch(`${API_BASE_URL}/files/${fileId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('upload-alert', 'success', 'تم حذف الملف بنجاح');
                    
                    // إعادة تحميل الصفحة الحالية بعد ثانية لتأكيد التحديث
                    setTimeout(() => {
                        if (currentLevel) {
                            showLevel(currentLevel);
                        } else if (currentTerm) {
                            showTerm(currentTerm);
                        }
                    }, 1000);
                } else {
                    showAlert('upload-alert', 'error', 'حدث خطأ أثناء حذف الملف');
                }
            })
            .catch(error => {
                showAlert('upload-alert', 'error', 'حدث خطأ أثناء حذف الملف');
            });
        }
        
        function goBackToFaculty() {
            showPage('faculty-page');
        }
        
        function goBackToDepartment() {
            showPage('department-page');
        }
        
        function goBackToLevel() {
            showPage('level-page');
        }
        
        // تحديث الأقسام عند اختيار الكلية في نموذج الرفع
        function updateDepartments() {
            const facultySelect = document.getElementById('faculty');
            const departmentSelect = document.getElementById('department');
            
            departmentSelect.innerHTML = '<option value="">اختر القسم</option>';
            
            if (facultySelect.value) {
                facultiesData[facultySelect.value].departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    departmentSelect.appendChild(option);
                });
            }
            
            updateSubjects();
        }
        
        // تحديث المواد عند اختيار الترم في نموذج الرفع
        function updateSubjects() {
            const faculty = document.getElementById('faculty').value;
            const department = document.getElementById('department').value;
            const level = document.getElementById('level').value;
            const term = document.getElementById('term').value;
            const subjectSelect = document.getElementById('subject');
            
            subjectSelect.innerHTML = '<option value="">اختر المادة</option>';
            
            if (faculty && department && level && term) {
                // جلب المواد من API
                fetch(`${API_BASE_URL}/subjects?faculty=${faculty}&department=${department}&level=${level}&term=${term}`)
                .then(response => response.json())
                .then(subjects => {
                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject.id;
                        option.textContent = subject.name;
                        subjectSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('حدث خطأ أثناء جلب المواد:', error);
                });
            }
        }
        
        // رفع ملف جديد
        function uploadFile() {
            if (!isAdmin) {
                showAlert('upload-alert', 'error', 'ليس لديك صلاحية رفع الملفات');
                return;
            }
            
            const fileType = document.getElementById('file-type').value;
            const faculty = document.getElementById('faculty').value;
            const department = document.getElementById('department').value;
            const level = document.getElementById('level').value;
            const term = document.getElementById('term').value;
            const subjectId = document.getElementById('subject').value;
            const fileName = document.getElementById('file-name').value;
            
            if (!fileType || !faculty || !department || !level || !term || !subjectId || !fileName) {
                showAlert('upload-alert', 'error', 'الرجاء ملء جميع الحقول');
                return;
            }
            
            const isDriveUpload = document.getElementById('drive-option').classList.contains('selected');
            const driveLink = document.getElementById('drive-link').value;
            
            if (isDriveUpload && !driveLink) {
                showAlert('upload-alert', 'error', 'الرجاء إدخال رابط جوجل درايف');
                return;
            }
            
            if (!isDriveUpload && !selectedFile) {
                showAlert('upload-alert', 'error', 'الرجاء اختيار ملف للرفع');
                return;
            }
            
            const formData = new FormData();
            formData.append('type', fileType);
            formData.append('faculty', faculty);
            formData.append('department', department);
            formData.append('level', level);
            formData.append('term', term);
            formData.append('subjectId', subjectId);
            formData.append('name', fileName);
            
            if (isDriveUpload) {
                formData.append('url', driveLink);
            } else {
                formData.append('file', selectedFile);
            }
            
            // رفع الملف إلى API
            fetch(`${API_BASE_URL}/files`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('upload-alert', 'success', 'تم رفع الملف بنجاح!');
                    
                    // إعادة تعيين النموذج
                    document.getElementById('upload-form').reset();
                    document.getElementById('file-preview').innerHTML = '';
                    selectedFile = null;
                    
                    // إعادة تحميل الصفحة الحالية بعد ثانية
                    setTimeout(() => {
                        if (currentLevel) {
                            showLevel(currentLevel);
                        } else if (currentTerm) {
                            showTerm(currentTerm);
                        }
                    }, 1000);
                } else {
                    showAlert('upload-alert', 'error', data.message);
                }
            })
            .catch(error => {
                showAlert('upload-alert', 'error', 'حدث خطأ أثناء رفع الملف');
            });
        }
        
        // وظائف صفحة تعديل المواد
        function updateEditDepartments() {
            const facultySelect = document.getElementById('edit-faculty');
            const departmentSelect = document.getElementById('edit-department');
            
            departmentSelect.innerHTML = '<option value="">اختر القسم</option>';
            
            if (facultySelect.value) {
                facultiesData[facultySelect.value].departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    departmentSelect.appendChild(option);
                });
            }
        }
        
        function updateEditLevels() {
            document.getElementById('edit-level').value = '';
            document.getElementById('edit-term').value = '';
            document.getElementById('subjects-edit-container').innerHTML = '';
        }
        
        function updateEditTerms() {
            document.getElementById('edit-term').value = '';
            document.getElementById('subjects-edit-container').innerHTML = '';
        }
        
        function loadSubjects() {
            if (!isAdmin) {
                showAlert('edit-alert', 'error', 'ليس لديك صلاحية تعديل المواد');
                showPage('home-page');
                return;
            }
            
            const faculty = document.getElementById('edit-faculty').value;
            const department = document.getElementById('edit-department').value;
            const level = document.getElementById('edit-level').value;
            const term = document.getElementById('edit-term').value;
            const container = document.getElementById('subjects-edit-container');
            
            container.innerHTML = '';
            
            if (!faculty || !department || !level || !term) {
                document.getElementById('edit-guidance').style.display = 'flex';
                return;
            }
            
            document.getElementById('edit-guidance').style.display = 'none';
            
            // جلب المواد من API
            fetch(`${API_BASE_URL}/subjects?faculty=${faculty}&department=${department}&level=${level}&term=${term}`)
            .then(response => response.json())
            .then(subjects => {
                // عرض حقول التعديل لكل مادة
                subjects.forEach(subject => {
                    const subjectDiv = document.createElement('div');
                    subjectDiv.className = 'form-group';
                    subjectDiv.innerHTML = `
                        <h3 style="color: var(--primary-color); margin: 1rem 0 0.5rem;">
                            <i class="fas fa-book"></i> ${subject.name}
                        </h3>
                        <div class="form-group">
                            <label for="subject-name-${subject.id}"><i class="fas fa-heading"></i> اسم المادة:</label>
                            <input type="text" id="subject-name-${subject.id}" value="${subject.name}" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="subject-desc-${subject.id}"><i class="fas fa-align-left"></i> وصف المادة:</label>
                            <textarea id="subject-desc-${subject.id}" rows="3" class="form-control">${subject.description}</textarea>
                        </div>
                    `;
                    container.appendChild(subjectDiv);
                });
            })
            .catch(error => {
                console.error('حدث خطأ أثناء جلب المواد:', error);
                container.innerHTML = '<p>حدث خطأ أثناء جلب المواد. يرجى المحاولة لاحقًا.</p>';
            });
        }
        
        function saveSubjects() {
            if (!isAdmin) {
                showAlert('edit-alert', 'error', 'ليس لديك صلاحية حفظ التعديلات');
                return;
            }
            
            const faculty = document.getElementById('edit-faculty').value;
            const department = document.getElementById('edit-department').value;
            const level = document.getElementById('edit-level').value;
            const term = document.getElementById('edit-term').value;
            
            if (!faculty || !department || !level || !term) {
                showAlert('edit-alert', 'error', 'الرجاء اختيار الكلية والقسم والمستوى والترم');
                return;
            }
            
            // جلب المواد من API
            fetch(`${API_BASE_URL}/subjects?faculty=${faculty}&department=${department}&level=${level}&term=${term}`)
            .then(response => response.json())
            .then(subjects => {
                const updates = [];
                
                subjects.forEach(subject => {
                    const name = document.getElementById(`subject-name-${subject.id}`).value;
                    const desc = document.getElementById(`subject-desc-${subject.id}`).value;
                    
                    updates.push({
                        id: subject.id,
                        name: name,
                        description: desc
                    });
                });
                
                // تحديث المواد في API
                fetch(`${API_BASE_URL}/subjects`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ updates })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showAlert('edit-alert', 'success', 'تم حفظ التعديلات بنجاح!');
                        
                        // إعادة تحميل الصفحة الحالية بعد ثانية
                        setTimeout(() => {
                            if (currentLevel) {
                                showLevel(currentLevel);
                            } else if (currentTerm) {
                                showTerm(currentTerm);
                            }
                        }, 1000);
                    } else {
                        showAlert('edit-alert', 'error', 'حدث خطأ أثناء حفظ التعديلات');
                    }
                })
                .catch(error => {
                    showAlert('edit-alert', 'error', 'حدث خطأ أثناء حفظ التعديلات');
                });
            })
            .catch(error => {
                console.error('حدث خطأ أثناء جلب المواد:', error);
            });
        }
        
        // وظائف إدارة الأقسام
        function loadDepartments() {
            const faculty = document.getElementById('manage-faculty').value;
            const container = document.getElementById('current-departments');
            container.innerHTML = '';
            
            if (!faculty) return;
            
            // جلب الأقسام من API
            fetch(`${API_BASE_URL}/departments?faculty=${faculty}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const departments = data.departments;
                    
                    if (departments.length === 0) {
                        container.innerHTML = '<p>لا توجد أقسام لهذه الكلية</p>';
                        return;
                    }
                    
                    const list = document.createElement('div');
                    list.className = 'departments-list';
                    list.innerHTML = '<h3>الأقسام الحالية:</h3>';
                    
                    departments.forEach(dept => {
                        const deptItem = document.createElement('div');
                        deptItem.className = 'department-item';
                        deptItem.innerHTML = `
                            <span>${dept}</span>
                            <div class="department-actions">
                                <button class="delete-btn" onclick="deleteDepartment('${faculty}', '${dept}')">
                                    <i class="fas fa-trash"></i> حذف
                                </button>
                            </div>
                        `;
                        list.appendChild(deptItem);
                    });
                    
                    container.appendChild(list);
                } else {
                    showAlert('departments-alert', 'error', 'حدث خطأ أثناء جلب الأقسام');
                }
            })
            .catch(error => {
                showAlert('departments-alert', 'error', 'حدث خطأ في الاتصال بالخادم');
            });
        }
        
        function addDepartment() {
            if (!isAdmin) {
                showAlert('departments-alert', 'error', 'ليس لديك صلاحية إضافة أقسام');
                return;
            }
            
            const faculty = document.getElementById('manage-faculty').value;
            const newDept = document.getElementById('new-department').value.trim();
            
            if (!faculty) {
                showAlert('departments-alert', 'error', 'الرجاء اختيار كلية');
                return;
            }
            
            if (!newDept) {
                showAlert('departments-alert', 'error', 'الرجاء إدخال اسم القسم');
                return;
            }
            
            // إضافة القسم إلى API
            fetch(`${API_BASE_URL}/departments`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ faculty, department: newDept })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('departments-alert', 'success', 'تمت إضافة القسم بنجاح');
                    
                    // تحديث البيانات المحلية
                    if (!facultiesData[faculty].departments.includes(newDept)) {
                        facultiesData[faculty].departments.push(newDept);
                    }
                    
                    // إعادة تحميل الأقسام
                    loadDepartments();
                    
                    // مسح حقل الإدخال
                    document.getElementById('new-department').value = '';
                } else {
                    showAlert('departments-alert', 'error', data.message);
                }
            })
            .catch(error => {
                showAlert('departments-alert', 'error', 'حدث خطأ أثناء إضافة القسم');
            });
        }
        
        function deleteDepartment(faculty, department) {
            if (!isAdmin) {
                showAlert('departments-alert', 'error', 'ليس لديك صلاحية حذف أقسام');
                return;
            }
            
            if (!confirm(`هل أنت متأكد من حذف قسم ${department}؟`)) return;
            
            // حذف القسم من API
            fetch(`${API_BASE_URL}/departments`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ faculty, department })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('departments-alert', 'success', 'تم حذف القسم بنجاح');
                    
                    // تحديث البيانات المحلية
                    const index = facultiesData[faculty].departments.indexOf(department);
                    if (index !== -1) {
                        facultiesData[faculty].departments.splice(index, 1);
                    }
                    
                    // إعادة تحميل الأقسام
                    loadDepartments();
                } else {
                    showAlert('departments-alert', 'error', 'حدث خطأ أثناء حذف القسم');
                }
            })
            .catch(error => {
                showAlert('departments-alert', 'error', 'حدث خطأ أثناء حذف القسم');
            });
        }
        
        // وظائف الدردشة
        function displayChatMessages() {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            if (currentStudent) {
                document.getElementById('student-status').style.display = 'flex';
                document.getElementById('current-student-name').textContent = currentStudent.name;
            }
            
            // جلب الرسائل من API
            fetch(`${API_BASE_URL}/chat?room=${currentChatRoom}`)
            .then(response => response.json())
            .then(messages => {
                if (messages.length === 0) {
                    messagesContainer.innerHTML = '<div class="no-messages">لا توجد رسائل بعد</div>';
                    return;
                }
                
                messages.forEach(message => {
                    addMessageToUI(message);
                });
            })
            .catch(error => {
                console.error('حدث خطأ أثناء جلب الرسائل:', error);
            });
        }
        
        function addMessageToUI(message) {
            const messagesContainer = document.getElementById('chat-messages');
            const isCurrentUser = currentStudent && message.userId === currentStudent.id;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isCurrentUser ? 'sent' : 'received'}`;
            messageDiv.innerHTML = `
                <div class="message-header">
                    <strong>${message.username}</strong>
                    <span>${message.timestamp}</span>
                </div>
                <div class="message-body">${message.text}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            
            // التمرير إلى آخر رسالة
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function sendMessage() {
            if (!currentStudent) {
                showAlert('student-login-alert', 'error', 'يجب تسجيل الدخول لإرسال الرسائل');
                return;
            }
            
            const input = document.getElementById('message-input');
            const messageText = input.value.trim();
            
            if (!messageText) return;
            
            if (messageText.length > MAX_MESSAGE_LENGTH) {
                showAlert('student-login-alert', 'error', `الحد الأقصى لطول الرسالة هو ${MAX_MESSAGE_LENGTH} حرفًا`);
                return;
            }
            
            const now = new Date();
            const timestamp = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const newMessage = {
                room: currentChatRoom,
                userId: currentStudent.id,
                username: currentStudent.name,
                text: messageText,
                timestamp: timestamp
            };
            
            // حفظ الرسالة في API
            fetch(`${API_BASE_URL}/chat`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newMessage)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addMessageToUI(newMessage);
                    input.value = '';
                } else {
                    showAlert('student-login-alert', 'error', 'حدث خطأ أثناء إرسال الرسالة');
                }
            })
            .catch(error => {
                showAlert('student-login-alert', 'error', 'حدث خطأ أثناء إرسال الرسالة');
            });
        }
        
        // إعداد مستمعي الأحداث لغرف الدردشة
        function setupChatRoomListeners() {
            const roomItems = document.querySelectorAll('.chat-room-item');
            roomItems.forEach(item => {
                item.addEventListener('click', function() {
                    // إزالة النشط من جميع العناصر
                    roomItems.forEach(i => i.classList.remove('active'));
                    // إضافة النشط للعنصر المحدد
                    this.classList.add('active');
                    
                    // تحديث الغرفة الحالية
                    currentChatRoom = this.getAttribute('data-room');
                    document.getElementById('current-chat-room').textContent = this.querySelector('span').textContent;
                    
                    // عرض رسائل الغرفة الجديدة
                    displayChatMessages();
                });
            });
        }
        
        // عند تحميل الصفحة
        window.onload = function() {
            // استدعاء الدالة للتحقق من حالة المصادقة
            checkAuthState();
            
            // إضافة مستمعين لأحداث التغيير
            document.getElementById('term').addEventListener('change', updateSubjects);
            document.getElementById('level').addEventListener('change', function() {
                document.getElementById('term').value = '';
                updateSubjects();
            });
            
            // إعداد مستمعي غرف الدردشة
            setupChatRoomListeners();
            
            // اختيار طريقة الرفع الافتراضية
            selectUploadOption('drive');
        };
    </script>
</body>
</html>